# Описание API
Здесь описано всё АПИ, используемое в приложении, с описанием структур данных


**Содержание**
1. Общее
    * 1.1. Адрес сервера
    * 1.2. Используемый протокол
2. Структуры данных
    * 2.1. Общий формат ответа
    * 2.2. Пользователь
    * 2.3. Сообщение
    * 2.4. Покемоны
    * 2.5. Инвентарь
    * 2.6. Карта
3. Список запросов
    * 3.1. Общие ошибки
4. Подробно
    * 4.1. login
    * 4.2. logout
    * 4.3. registration
    * 4.4. sendMessage
    * 4.5. getMessages
    * 4.6. userInfo
    * 4.7. upgradePokemon
    * 4.8. startGame
    * 4.9. endGame
    * 4.18. addToTeam


## 1. Общее
### 1.1. Адрес сервера
`http://nopainnogame.local/api`

### 1.2. Используемый протокол
API полностью реализовано на http(s).

Формат возвращаемых значений `JSON`.

Все методы, если это особо не оговорено, имеют тип `GET`.


## 2. Структуры данных
### 2.1. Общий формат ответа
`T` - какие-то данные. В случае успешного ответа возвращается `result = 'ok'` и поле `data` с данными.

В случае ошибки возвращается `result = 'error'` и поле `error` с кодом и текстом ошибки
```
Answer<T>: {
    result: 'ok' | 'error';
    data?: T;
    error?: {
        code: number;
        text: string;
    };
}
```

### 2.2. Пользователь
```
User: {
    id: number;
    token: string;
    name: string;
}
```

### 2.3. Сообщение
```
Message: {
    message: string;
    author: string;
    created: string;
}
```

### 2.4. Покемоны
```
Monsters: {
    id: number; - ID покемона
    name: string; - Имя покемона
    level: number; - Уровень покемона
    mosters_type_id: integer; - ID типа монстра
    hp: ineger; - Уровень здоровья покемона
    status: string; - Статус покемона (в команде, в кармане)
}
```

### 2.5. Инвентарь
```
Inventory: {
    id: integer; - ID инвенторя
    user_id: integer; - ID пользователя
    resoure: integer; - количество ресурса
    resoure_type: string; - тип ресурса (кристаллы, яйца, осколки) 
    element_id: integer; - ID стихии
}
```

### 2.5. Инвентарь
```
PlayerIngame: {
    id: integer; - ID игрока
    name: integer; - имя игрока
    status: string; - статус игрока на карте ('scout' - на карте, 'fight' - в бою, 'offline' - не в игре) // надо сделать отдельно таблицу словарь для статусов
    x: integer; - текущая координата х
    y: integer; - текущая координата y
}
```

## 3. Список запросов
| Название | О чем |
| - | - |
| login | Авторизация пользователя |
| logout | Логаут пользователя |
| registration | Регистрация пользователя |
| sendMessage | Отправить сообщение в чат |
| getMessages | Получить сообщения в чате |
| userInfo | Получить информацию о пользователе и его наборе покемонов|
| upgradePokemon | Улучшение покемонов |
| startGame | Начало игры |
| endGame | Конец игры на карте |
| addToTeam | Добавить монстра в отряд |

### 3.1. Общие ошибки
* `101` - если не передан параметр `method`
* `102` - если переданное значение в параметре `method` не обрабатывается
* `242` - не переданы все необходимые параметры
* `705` - пользователь не найден 


## 4. Подробно
### 4.1. login
Авторизация пользователя в системе

**Параметры**
```
{
    login: string; - логин пользователя
    hash: string; - контрольная сумма, равная hash = md5(nd5(login + password) + rnd)
    rnd: number; - случайно целое число
}
```
**Успешный ответ**
```
    Answer<User, Monsters, Inventory>
```
**Ошибки**
* `1002` - неверный пароль
* `1005` - неверный логин


### 4.2. logout
Вылогин пользователя из системы

**Параметры**
```
{
    token: string
}
```
**Успешный ответ**
```
    Answer<true>
```
**Ошибки**
* `1003` - неверный пароль


### 4.3. registration
Зарегистрировать нового ползователя

**Параметры**
```
{
    login: string; - логин пользователя
    password: string; - хеш пароля: md5(login + password)
    name: string; - имя пользователя
}
```
**Успешный ответ**
```
    Answer<User, Monsters, Inventory>
```
**Ошибки**
* `1001` - такой логин уже существует
* `1004` - ошибка при регистрации пользователя


### 4.4. sendMessage
Послать сообщение в чат

**Параметры**
```
{
    token: string; - токен
    message: string; - текст сообщения
}
```
**Успешный ответ**
```
    Answer<true>
```
**Ошибки**
* `705` - невалидный токен. Пользователь не авторизован


### 4.5. getMessages
Получить все сообщения чата

**Параметры**
```
{
    token: string; - токен
    hash: string; - хеш-сумма чата
}
```
**Успешный ответ**
```
    Answer<{
        messages: Message[]; - список сообщений
        hash: string; - новый хеш чата
    }>
```
**Примечание**: в случае отсутствия новых сообщений будет ответ:
```
    Answer<
        hash: string; - новый хеш чата
    >
```
**Ошибки**
* `705` - невалидный токен. Пользователь не авторизован

#### 4.6. userInfo
Получение информации о пользователе и его покемонов.

**Параметры**
```
{
    token: string; - токен
}
```

**Успешный ответ**
```
    Answer<User, Monsters, Inventory>
```

**Ошибки**
*`705` - пользователь не найден

#### 4.7. upgradePokemon
Улучшение покемонов

**Параметры**
```
{
    token: string; - токен
    monsterId: number; - ID покемона 
}
```
    
**Успешный ответ**
```
    Answer<{
        level: number; - уровень покемона
        hp: number; - здоровье покемона
    }>
```
**Ошибки**

*`705` -  пользователь не найден
*`702` - Покемон не найден.
*`703` - Покемон максимального уровня
*`802` - Не хватает средств

### 4.10. moveUser
Изменить координаты игрока (перемещение)

**Параметры**
```
{
    token: string; - токен
    x: string; - координата x
    y: string; - координата y
    x и y приходят как строка с кавычками 
}
```
**Успешный ответ**
```
    Answer<true>
```
**Ошибки**
* `705` - Невалидный токен. Пользователь не авторизован.
* `850` - Не был передан массив или не получилось достать него из данные.
* `2001` - Невозможно переместиться. Не переданы координаты для передвижения.
* `2002` - Невозможно переместиться. Координаты для передвижения не являются числовой строкой с целым числом или отрицательны.
* `2003` - Невозможно переместиться. Координаты для передвижения выходят за "край" карты.
* `2004` - Невозможно переместиться. Перемещаемый пользователь уже находится на данных координатах.
* `2005` - Невозможно переместиться. Пользователь находится в бою или оффлайн.

### 4.11. getMap
Возвращает данные о карте из БД

**Параметры**
```
{
    token: string; - токен
}
```
**Успешный ответ**
```
    Answer<{
        map: Map[]; - список параметров карты
        mapZones: MapZones[]; - список параметров зон карты
    }>
```
**Ошибки**
* `705` - невалидный токен. Пользователь не авторизован

### 4.12. updateScene
Возвращает данные о пользователях в игре

**Параметры**
```
{
    token: string; - токен
    hash: string; - хэш карты
}
```
**Успешный ответ**
```
    Answer<{
        playerIngames: PlayerIngame[]; - список игроков в игре
        hash: string; - обновленный хэш
    }>
```
**Ошибки**
* `705` - невалидный токен. Пользователь не авторизован


### 4.13. getAllLots
возвращает список всех лотов, если пользователь находится в городе
<!---выводит вообще ВСЕ лоты, даже завершенные, фильтровать уже нужно на фронте по статусу "open"-->

**Параметры**
```
{
    token: string; - токен
}
```
**Успешный ответ**
```
    Answer<lots>
```
**Ошибки**
* `705` - невалидный токен. Пользователь не авторизован
* `2999` - пользователь находится не в городе.

### 4. getCatalog <!---поменять номер в девелопе-->
возвращает список всех предложений торговца, если пользователь находится в городе

**Параметры**
```
{
    token: string; - токен
}
```
**Успешный ответ**
```
    Answer<resources>
```
**Ошибки**
* `705` - невалидный токен. Пользователь не авторизован
* `2999` - пользователь находится не в городе.


### 4.14. sell
продает ресурсы из инвентаря за монеты или обменивает осколки на яйца

**Параметры**
```
{
    token: string; - токен
    type: string; - тип продажи: merchant для продажи торговцу, exchanger для обмена скорлупы
    amount: string; количество продаваемого или обмениваемого ресурса. Если это скорлупки, то число должно быть кратное 50
    objectId: string || null; передается только если тип продажи merchant
}
```
**Успешный ответ**
```
    Answer<{
        resDecrease: true; - ресурсы успешно списались из инвентаря пользователя
        moneyIncrease || eggIncrease: true; - деньги / яйца успешно начислились пользователю
        message: [Resources[] || null, int]; - данные у продаваемом ресурсе, если тип продажи merchant и количество проданного / обменянного ресурса
    }>
```
**Ошибки**
* `705` - невалидный токен. Пользователь не авторизован
* `3001` - некорректный параметр type
* `3002` - некорректный параметр amount или objectId
* `3007` - инвентарь пользователя с данным айди не был найден
* `3008` - продаваемый ресурс с данным айди не был найден
* `3009` - недостаточно ресурсов, чтобы продать данное количество
* `3010` - данное количество Скорлуп не может быть обменено
* `3011` - недостаточно Скорлуп чтобы обменять данное количество

### 4.18. addToTeam
добавляет монстра в команду
добавляет, только если у монстра статус 'in pocket'
убирает из команды
убирает, только если у монстра статус 'in team'


**Параметры**
```
{
    token: string; - токен
    monsterId: number; - айди монстра
}
```
**Успешный ответ**
```
    Answer<true>
```
**Ошибки**
* `705` - невалидный токен. Пользователь не авторизован
* `3007` - инвентарь пользователя с данным айди не был найден
* `1450` - этот монстр выставлен на продажу, невозможно добавить в отряд
* `1460` - монстр с данным айди не был найден